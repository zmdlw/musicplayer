function Inniver(hash, limit, blockedContentName) 
{
    this.blockedContentName = blockedContentName;
    this.hash = hash;
	this.limit = limit;
    this.api = 'https://api-inniver-dot-innivernew.ue.r.appspot.com/api/v1/';
    
}

Inniver.prototype.unlock = function(action) {
    
    switch (action.unblockMethod)  
    {
        case 'RedirectTo':
            window.location.assign(action.unblockLink);
            break;

        case 'JavaScriptEval':
            eval(action.javascriptEval);
            break;

        case 'Close':
            break;
    }
    
};

Inniver.prototype.live = function() {
    
    var self = this;
    
    $.get(this.api + 'tracking/' + this.trackingId + '/status', function(res) {
        if (res.data.isContentUnblocked)  
        {
            clearInterval(self.liveInterval);
            self.unlock(res.data);
        }
    }, 'json');
    
};

Inniver.prototype.startTracking = function() {
    
    var self = this;
    
    $.get(this.api + 'tracking/offers/' + this.hash + '/start' + '?referer=' + btoa(window.location.href) + '&blocked-content-name=' + this.blockedContentName, function(res) {

        if (res.data.trackingId) 
        {
            
            self.trackingId = res.data.trackingId;
            self.offers = res.data.offers.slice(0, self.limit);
            
            const feed = document.createDocumentFragment();
            $.each(self.offers, function(key, offer) {
                const a = document.createElement('a');
                a.className = 'offer-link py-3 px-4';
                a.href = offer.offerTrackingUrl;
                a.target = '_blank';
                a.textContent = offer.lockingTitle;
                feed.appendChild(a);
            });
            
            $('#offers-output').append(feed);
            
            $('#step1').fadeOut('fast', function() {
               $('#step2').fadeIn('fast'); 
            });
            
            self.liveInterval = setInterval(function() {
                self.live();
            }, 60000);
            
        }
        
    }, 'json');
    
};